<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
  <link rel="stylesheet" href="../../css/dash.css">
  <link rel="shortcut icon" href="../../img/logo-login.png" type="image/x-icon">
  <script defer src="../../js/dash.js"></script>
  <script defer src="../../funcoes.js"></script>

  <!-- links api -->
  <link rel="stylesheet" href="../../css/loading-bar.css">
  <link rel="stylesheet" href="../../css/loading-bar.min.css">
  <script src="../../js/loading-bar.js"></script>
  <script src="../../js/loading-bar.min.js"></script>
  <title>KCODE</title>
</head>

<body onload="verificar_autenticacao()">
  <main class="page">
    <div class="menu">
      <div class="container">
        <div class="navigation">
          <ul>
            <li>
              <a href="dashboard.html">
                <span class="icon">
                  <i class="fa fa-home" aria-hidden="true"></i>
                </span>
                <span class="title">Home</span>
              </a>
            </li>
            <li>
              <a href="perfildev.html">
                <span class="icon">
                  <i class="fa fa-user" aria-hidden="true"></i>
                </span>
                <span class="title">Profile</span>
              </a>
            </li>
            <li>
              <a href="tutorial.html">
                <span class="icon">
                  <i class="fa fa-question-circle" aria-hidden="true"></i>
                </span>
                <span class="title">Tutorial</span>
              </a>
            </li>
            <li>
              <a href="#" onclick="darkMode()">
                <span class="icon">
                  <i class="fa fa-cog" aria-hidden="true">
                  </i>
                </span>
                <span class="title">Settings</span>
              </a>
            </li>
            <li>
              <a href="#" onclick="logoff()">
                <span class="icon">
                  <i class="fa fa-sign-out" aria-hidden="true"></i>
                </span>
                <span class="title">Sign Out</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="toggle"></div>
      </div>
    </div>
    <!-- menu end-->
    <header>
      <div class="box-recepction">
        <div class="recection-welcome">
          <h1>Veja aqui seu consumo de hardware em relação a IDE! </h1>
         
        </div>
        <div class="logo-recepction">
          <img src="../../img/logo-maior.png" alt="" id="logo-kcode">

        </div>
      </div>
    </header>

    <section class="section-graficos">
      <div class="container-info">

        <div class="info-img">
         
            <img src="../../img/netbeans64.png" alt="" id="imgLogoIDE"  class="ide-graficohardware">
  
            <p id="nomeIDE">Netbeans</p>
          
          
        </div>

        <div class="legenda-2">

        <div class="box-ram">
         <div class="uso-ram"></div> 
         <p>Uso</p> 
        </div>

        <div class="box-ram">
          <div class="uso-livre"></div> 
          <p>Livre</p> 
         </div>

        </div>
        
        </div>
      <div class="container-graficos">

        <div class="graficos">
          <div class="box-graficos">

            <div id="graficoDisco" style="width: 60%; height: 60%;" class="label-center" data-precision="0.1" data-preset="circle"> </div>
            
            <div class="label-grafico">DISCO</div>

          </div>
          <div class="box-graficos">
            <div id="graficoRam" style="width: 60%; height: 60%;" class="label-center" data-precision="0.1"
              data-preset="circle"> </div>
            
            <div class="label-grafico">RAM</div>
          </div>
        </div>
        <div class="graficos">
          <div class="box-graficos">
            <div id="graficoCPU" style="width: 60%; height: 60%;" class="label-center" data-precision="0.1"
              data-preset="circle"> </div>
            
            <div class="label-grafico">CPU</div>
          </div>
          <div class="box-graficos">
            <img src="../../img/relogio.svg" alt="relôgio" style="width: 60%; height: 60%;"">
            
            <div id="grafico_tempo_us" class="label-grafico"></div>
          </div>
        </div>
        
          
        </div>
       

      </div>

    </section>
    <div class="footer-ajuda">

     

      <div class="ajuda">

        <input type="submit" value="Ajuda" />




        </button>

      </div>

    </div>

    </div>

    </div>

  </main>
</body>

</html>


<!-- script cria grafico -->
<script>

  let valorTempo
  let valorDisco;
  let valorRam;
  let valorCPU;
  let inicioIDE;
  let fimIDE;

  let contadorGrafico = 0

  window.onload = verificar_autenticacao()
  // window.onload = obterDadosGraficoIDE(1);
  // window.onload = carregarGrafico();

  function carregarGrafico() {
    setInterval(
      function myFunction() {
        obterDadosGraficoIDE(ide_usuario, id_usuario)
      }, 5000)

  };

  function obterDadosGraficoIDE(IDE, id_usuario) {
    fetch(`/leituras/processos/ide/${IDE}/${id_usuario}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {

          // console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          // console.log(`Dados recebidos: ${resposta}`);
          var resultado = [];
          let nomesTratadosIDE = ["Xcode", "PyCharm", "Visual studio code", "Netbeans", "Intellij", "Android studio",
            "PHPStorm", "WebStorm", "Eclipse", "Visual studio"]
          function percorrer(obj) {
            for (var propriedade in obj) {
              if (obj.hasOwnProperty(propriedade)) {
                if (typeof obj[propriedade] == "object") {
                  percorrer(obj[propriedade]);
                } else {
                  resultado.push(obj[propriedade]);
                }
              }
            }
          }

          imgLogoIDE.src = `../../img/${IDE}.png`
          switch (IDE) {
                      case "Xcode":
                        nomeIDE.innerHTML = nomesTratadosIDE[0]
                        break;
                      case "pycharm64":
                        nomeIDE.innerHTML = nomesTratadosIDE[1]
                        break;
                      case "Code":
                        nomeIDE.innerHTML = nomesTratadosIDE[2]
                        break;
                      case "netbeans64":
                        nomeIDE.innerHTML = nomesTratadosIDE[3]
                        break;
                      case "idea64":
                        nomeIDE.innerHTML = nomesTratadosIDE[4]
                        break;
                      case "studio64":
                        nomeIDE.innerHTML = nomesTratadosIDE[5]
                        break;
                      case "phpstorm64":
                        nomeIDE.innerHTML = nomesTratadosIDE[6]
                        break;
                      case "webstorm64":
                        nomeIDE.innerHTML = nomesTratadosIDE[7]
                        break;
                      case "eclipse":
                        nomeIDE.innerHTML = nomesTratadosIDE[8]
                        break;
                      case "devenv":
                        nomeIDE.innerHTML = nomesTratadosIDE[9]
                        break;
                      default:
                        break;
                    }

          percorrer(resposta);
          // console.log(JSON.stringify(resultado));

          let inicioIDE = resultado[0]
          let fimIDE = resultado[1]
          valorRam = resultado[2]
          valorCPU = resultado[3]
          valorDisco = resultado[4]

          valorInicio = inicioIDE.split("T")
          valorFim = fimIDE.split("T")

          var tempoInicio = valorInicio[0] + " " + valorInicio[1]
          tempoInicio = tempoInicio.slice(0, -5)

          var tempoFim = valorFim[0] + " " + valorFim[1]
          tempoFim = tempoFim.slice(0, -5)

          // console.log(tempoInicio)
          // console.log(tempoFim)

          var us_data_inicio = valorInicio[0];
          us_data_inicio = us_data_inicio.split("-").join('');

          var us_data_fim = valorFim[0];
          us_data_fim = us_data_fim.split("-").join('');

          var us_hr_inicio = valorInicio[1];
          us_hr_inicio = us_hr_inicio.slice(0, -3);

          var us_hr_fim = valorFim[1];
          us_hr_fim = us_hr_fim.slice(0, -3);

          var dias_uso = us_data_fim - us_data_inicio;
          var hr_uso = us_hr_fim - us_hr_inicio;

          function isHoraInicialMenorHoraFinal(horaInicial, horaFinal) {
            horaIni = horaInicial; horaFim = horaFinal;

            // Verifica as horas. Se forem diferentes, é só ver se a inicial 
            // é menor que a final. 
            hIni = parseInt(horaIni[0], 10);
            hFim = parseInt(horaFim[0], 10);
            if (hIni != hFim)
              return hIni < hFim;

            // Se as horas são iguais, verifica os minutos então. 
            mIni = parseInt(horaIni[1], 10);
            mFim = parseInt(horaFim[1], 10);
            if (mIni != mFim)
              return mIni < mFim;
          }

          //Função utilizada para calculo de uso em horas já com resultado do calculo de dias.
          function diferencaHoras(horaFinal, horaInicial) {
            if (!isHoraInicialMenorHoraFinal(horaInicial, horaFinal)) {
              aux = horaFinal;
              horaFinal = horaInicial;
              horaInicial = aux;
            }
            hIni = horaInicial.split(":");
            hFim = horaFinal.split(":");
            horasTotal = parseInt(hFim[0], 10) - parseInt(hIni[0], 10);
            minutosTotal = parseInt(hFim[1], 10) - parseInt(hIni[1], 10);
            if (minutosTotal < 0) {
              minutosTotal += 60; horasTotal -= 1;
            }
            horaFinal = dias_uso + "D " + (horasTotal) + "h" + ":" + (minutosTotal) + "m";
            grafico_tempo_us.innerHTML = horaFinal
            return horaFinal;
          }

          diferencaHoras(us_hr_inicio, us_hr_fim);

          console.log(diferencaHoras(us_hr_inicio, us_hr_fim))
          // console.log(dias_uso)
          // console.log(us_data_inicio)
          // console.log(us_data_fim)
          // console.log(us_hr_inicio)
          // console.log(us_hr_fim)

          valorDisco = valorDisco / 1024 / 1024 / 1024

          // console.log("inicio " + valorInicio)
          console.log("fim " + valorFim)
          console.log("ram " + valorRam)
          console.log("cpu " + valorCPU)
          console.log("disco " + valorDisco)
          console.log("Resultado: " + resultado)

          // grafico disco
          var discoGrafico = new ldBar("#graficoDisco");
          var discoGrafico2 = document.getElementById('graficoDisco').ldBar;
          discoGrafico.set(valorDisco.toFixed(2))

          // grafico ram
          var ramGrafico = new ldBar("#graficoRam");
          var ramGrafico2 = document.getElementById('graficoRam').ldBar;
          ramGrafico.set(valorRam.toFixed(2))

          // grafico cpu
          var cpuGrafico = new ldBar("#graficoCPU");
          var cpuGrafico2 = document.getElementById('graficoCPU').ldBar;
          cpuGrafico.set(valorCPU.toFixed(2))

          // grafico tempo
          valorTempo = 32;

          resposta.reverse();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });

  }

  console.log("ram2 " + valorRam)
  console.log("cpu2 " + valorCPU)
  console.log("disco2 " + valorDisco)


</script>

<!-- estilo do grafico -->
<style>
  .label-center path.mainline {
    stroke-width: 10;
    stroke:#B73447;
  }

  .label-center path.baseline {
    stroke-width: 9;
    stroke: #A3C6C1;
  }
</style>

<!-- estilo da label central -->
<style type="text/css">
  .ldBar-label {
    color: #514E4D;
    font-family: 'Bebas Neue';
    font-size: 2.1em;
    font-weight: 900;
  }
</style>