<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
  <link rel="stylesheet" href="../../css/dash.css">
  <link rel="shortcut icon" href="../../img/logo-login.png" type="image/x-icon">
  <script defer src="../../js/dash.js"></script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.4.0/moment.min.js"></script>


  <!-- links api -->
  <link rel="stylesheet" href="../../css/loading-bar.css">
  <link rel="stylesheet" href="../../css/loading-bar.min.css">
  <script src="../../js/loading-bar.js"></script>
  <script src="../../js/loading-bar.min.js"></script>
  <title>KCODE</title>
</head>

<body onload="verificar_autenticacao()">
  <main class="page">
    <div class="menu">
      <div class="container">
        <div class="navigation">
          <ul>
            <li>
              <a href="#">
                <span class="icon">
                  <i class="fa fa-home" aria-hidden="true" style="color: cadetblue;"></i>
                </span>
                <span class="title">Home</span>
              </a>
            </li>
            <li>
              <a href="perfildev.html">
                <span class="icon">
                  <i class="fa fa-user" aria-hidden="true"></i>
                </span>
                <span class="title">Profile</span>
              </a>
            </li>
            <li>
              <a href="tutorial.html">
                <span class="icon">
                  <i class="fa fa-question-circle" aria-hidden="true"></i>
                </span>
                <span class="title">Tutorial</span>
              </a>
            </li>
            <li>
              <a href="#">
                <span class="icon">
                  <i class="fa fa-cog" aria-hidden="true" onclick="darkMode()">
                  </i>
                </span>
                <span class="title">Settings</span>
              </a>
            </li>
            <li>
              <a href="#">
                <span class="icon">
                  <i class="fa fa-sign-out" aria-hidden="true" onclick="logoff()"></i>
                </span>
                <span class="title">Sign Out</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="toggle"></div>
      </div>
    </div>
    <!-- menu end-->
    <header>
      <div class="box-recepction">
        <div class="recection-welcome">
          <h1>Bem vindo, <b id="b_usuario"></b> </h1>
          <br>
          <p>Veja aqui seu consumo de hardware em relação a IDE</p>
        </div>
        <div class="logo-recepction">
          <img src="../../img/logo-maior.png" alt="" id="logo-kcode">

        </div>
      </div>
    </header>

    <section class="section-graficos">
      <div class="container-graficos">

        <div class="graficos">
          <div class="box-graficos">

            <div id="graficoDisco" style="width: 70%; height: 70%;" class="label-center" data-preset="circle"> </div>
            <br>
            <div class="label-grafico">DISCO</div>

          </div>
          <div class="box-graficos">
            <div id="graficoRam" style="width: 70%; height: 70%;" class="label-center" data-preset="circle"> </div>
            <br>
            <div class="label-grafico">RAM</div>
          </div>
        </div>
        <div class="graficos">
          <div class="box-graficos">
            <div id="graficoCPU" style="width: 70%; height: 70%;" class="label-center" data-preset="circle"> </div>
            <br>
            <div class="label-grafico">CPU</div>
          </div>
          <div class="box-graficos">
            <img src="../../img/relogio.svg" alt="relôgio" style="height: 187px;">
            <br>
            <div id="grafico_tempo_us" class="label-grafico">21H 00M</div>
          </div>
        </div>
        <div class="status">
          <div class="livre"></div>
          <div class="legenda">
            <p>Livre</p>
          </div>

          <div class="uso"></div>
          <div class="legenda">
            <p>Em uso</p>
          </div>

        </div>
        <div class="logo-ide">


        </div>

      </div>

    </section>
    <div class="footer-ajuda">


      <div class="ajuda">

        <button id="btn-ajuda">
          <h1>Ajuda!</h1>



        </button>

      </div>

    </div>

    </div>

    </div>

  </main>
</body>

</html>


<!-- script cria grafico -->
<script>

  // import 'moment-precise-range-plugin';

  let valorTempo
  let valorDisco;
  let valorRam;
  let valorCPU;
  let inicioIDE;
  let fimIDE;
  // let valorTempo;

  window.onload = obterDadosGraficoPrimeiraVez(1);

  function obterDadosGraficoPrimeiraVez(idprocessos) {

    fetch(`/leituras/ultimas/${idprocessos}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {


          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          console.log(`Dados recebidos: ${resposta}`);
          var resultado = [];

          function percorrer(obj) {
            for (var propriedade in obj) {
              if (obj.hasOwnProperty(propriedade)) {
                if (typeof obj[propriedade] == "object") {
                  percorrer(obj[propriedade]);
                } else {
                  resultado.push(obj[propriedade]);
                }
              }
            }
          }

          percorrer(resposta);
          console.log(JSON.stringify(resultado));


          // ram cpu disco = 5 6 7 
          // var nomeIDE = resultado[3]
          let inicioIDE = resultado[0]
          let fimIDE = resultado[1]
          valorRam = resultado[2]
          valorCPU = resultado[3]
          valorDisco = resultado[4]

          valorInicio = inicioIDE.split("T")
          valorFim = fimIDE.split("T")

          // var dtChegada = "20/06/2017 16:40:00";
          // var dtPartida = "20/06/2017 11:20:00";


          var dtChegada = "20/06/2017 16:40:00";
          var dtPartida = "20/06/2017 11:20:00";

          var ms = moment(dtChegada, "DD/MM/YYYY HH:mm:ss").diff(moment(dtPartida, "DD/MM/YYYY HH:mm:ss"));
          var d = moment.duration(ms);
          var s = Math.floor(d.asHours()) + "h" + moment.utc(ms).format(" mm") + "m";

          console.log(s);


          var tempoInicio = valorInicio[0] + " " + valorInicio[1]
          tempoInicio = tempoInicio.slice(0, -5)

          var tempoFim = valorFim[0] + " " + valorFim[1]
          tempoFim = tempoFim.slice(0, -5)

          console.log(tempoInicio)
          console.log(tempoFim)

          var us_data_inicio = valorInicio[0];
          us_data_inicio = us_data_inicio.split("-").join('');

          var us_data_fim = valorFim[0];
          us_data_fim = us_data_fim.split("-").join('');

          var us_hr_inicio = valorInicio[1];
          us_hr_inicio = us_hr_inicio.slice(0, -3);

          var us_hr_fim = valorFim[1];
          us_hr_fim = us_hr_fim.slice(0, -3);

          var dias_uso = us_data_fim - us_data_inicio;
          var hr_uso = us_hr_fim - us_hr_inicio;

          function isHoraInicialMenorHoraFinal(horaInicial, horaFinal) {
            horaIni = horaInicial; horaFim = horaFinal;

            // Verifica as horas. Se forem diferentes, é só ver se a inicial 
            // é menor que a final. 
            hIni = parseInt(horaIni[0], 10);
            hFim = parseInt(horaFim[0], 10);
            if (hIni != hFim)
              return hIni < hFim;

            // Se as horas são iguais, verifica os minutos então. 
            mIni = parseInt(horaIni[1], 10);
            mFim = parseInt(horaFim[1], 10);
            if (mIni != mFim)
              return mIni < mFim;
          }
          function diferencaHoras(horaInicial, horaFinal) {
            if (!isHoraInicialMenorHoraFinal(horaInicial, horaFinal)) {
              aux = horaFinal;
              horaFinal = horaInicial;
              horaInicial = aux;
            }
            hIni = horaInicial.split(":");
            hFim = horaFinal.split(":");
            horasTotal = parseInt(hFim[0], 10) - parseInt(hIni[0], 10);
            minutosTotal = parseInt(hFim[1], 10) - parseInt(hIni[1], 10);
            if (minutosTotal < 0) {
              minutosTotal += 60; horasTotal -= 1;
            }
            horaFinal = dias_uso + "D " + (horasTotal) + "h" + ":" + (minutosTotal) + "m";
            grafico_tempo_us.innerHTML = horaFinal
            return horaFinal;
          }

          console.log(diferencaHoras(us_hr_inicio, us_hr_fim))
          console.log(dias_uso)
          console.log(us_data_inicio)
          console.log(us_data_fim)
          console.log(us_hr_inicio)
          console.log(us_hr_fim)


          // var tempoUso = moment(tempoInicio).preciseDiff(tempoFim);
          var tempoUso = moment.preciseDiff("tempoInicio", "tempoFim");
          // var s = Math.floor(d.asHours()) + moment.utc(ms).format(":mm:ss");

          // console.log(d);

          console.log("teste " + tempoUso)

          console.log("inicio " + valorInicio)
          console.log("fim " + valorFim)
          console.log("ram " + valorRam)
          console.log("cpu " + valorCPU)
          console.log("disco " + valorDisco)

          // grafico disco
          var discoGrafico = new ldBar("#graficoDisco");
          var discoGrafico2 = document.getElementById('graficoDisco').ldBar;
          discoGrafico.set(valorDisco)

          // grafico ram
          var ramGrafico = new ldBar("#graficoRam");
          var ramGrafico2 = document.getElementById('graficoRam').ldBar;
          ramGrafico.set(valorRam)

          // grafico cpu
          var cpuGrafico = new ldBar("#graficoCPU");
          var cpuGrafico2 = document.getElementById('graficoCPU').ldBar;
          cpuGrafico.set(valorCPU)

          // grafico tempo
          var tempoGrafico = new ldBar("#graficoTempo");
          var tempoGrafico2 = document.getElementById('graficoTempo').ldBar;
          valorTempo = 32;
          tempoGrafico.set(valorTempo)

          resposta.reverse();
          obterDadosGraficoPrimeiraVez = setTimeout(() => obterDadosGraficoPrimeiraVez(idprocessos), 5000);
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });

  }

  console.log("ram2 " + valorRam)
  console.log("cpu2 " + valorCPU)
  console.log("disco2 " + valorDisco)


</script>

<!-- estilo do grafico -->
<style>
  .label-center path.mainline {
    stroke-width: 10;
    stroke: #6E9692;
    /* stroke-linecap: round; */
  }

  .label-center path.baseline {
    stroke-width: 9;
    stroke: #A3C6C1;
    /* stroke-linecap: round; */
  }
</style>

<!-- estilo da label central -->
<style type="text/css">
  .ldBar-label {
    color: #514E4D;
    font-family: 'Bebas Neue';
    font-size: 2.5em;
    font-weight: 900;
  }
</style>